/* knockout.contextmenu v1.0.0
   Nicol√°s Escalante - nlante@gmail.com
   Issues: https://github.com/nescalante/knockout.contextmenu/issues
   License: MIT */

!function(O){"use strict";function e(M){var f,d,i=[],e=M.utils,p=e.registerEventHandler,C=M.isObservable;function h(){if(f&&f.parentNode&&(f.parentNode.removeChild(f),d)){var e=document.querySelectorAll("."+d);[].forEach.call(e,function(e){e.classList.remove(d)})}f=null}function o(e){for(var t=0;t<i.length;t++)if(i[t].element===e)return i[t]}p(document,"click",function(e){var t=e.which||e.button;!e.defaultPrevented&&t<2&&h()}),e.contextMenu={getMenuFor:function(e,t){var n=o(e);if(n)return n.get(t)},openMenuFor:function(e,t){var n=o(e);if(n)return n.open(t)}},M.bindingHandlers.contextMenu={init:function(o,e,t,l){var s,w=e()||{},n=t(),a=n.contextMenuClass||"context-menu";function r(e){return e.pageX?e.pageX:e.clientX?e.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft):null}function c(e){return e.pageY?e.pageY:e.clientY?e.clientY+(document.documentElement.scrollTop||document.body.scrollTop):null}function u(e){var t;if(t=(s=function(e){var t,y=!1,g=[],x=[],k=[];Object.keys(M.isObservable(w)?w():w).forEach(function(e){var t,i,n,o,l,s,a,r,c,u,f,d,p,h,b,v,m;i=e,o=n="",l=M.isObservable(w)?w()[i]:w[i],a=(s=l||{}).id,r=C(s.url)?s.url():s.url,c=s.visible===O||null===s.visible||C(s.visible)&&s.visible()||!C(s.visible)&&!!s.visible,u=!1,f=!s.disabled||C(s.disabled)&&!s.disabled()||C(s.enabled)&&s.enabled()||!C(s.enabled)&&!!s.enabled,d=!1,p=!f,(h=!!l.separator)||((n=C(s.text)?s.text():s.text)||(n=i),o=r?'<a href="'+r+'">'+n+"</a>":n),(C(s)&&"boolean"==typeof s()||C(s.action)&&"boolean"==typeof s.action())&&(d=!0,(s.action&&s.action()||"function"==typeof s&&s())&&(u=!0)),v=[],m="",(b={html:o,text:n,url:r,id:a,isVisible:c,isChecked:u,isEnabled:f,isDisabled:p,isBoolean:d,isSeparator:h,action:function(e,t){var n=i+" option must have an action or an url.";if(p)return!1;if(C(s)&&"boolean"==typeof s())s(!s());else if("object"==typeof s){if(!(s.action||r||h))throw n;s.action&&(C(s.action)&&"boolean"==typeof s.action()?s.action(!s.action()):s.action(e,t))}else{if("function"!=typeof s)throw n;s(e,t)}return!0}}).isVisible&&(y=y||b.isBoolean,b.id&&(m=b.id),b.isChecked&&v.push("checked"),b.isDisabled&&v.push("disabled"),b.isSeparator&&v.push("separator"),b.url&&v.push("with-url"),t="<li "+(m?'id="'+m+'" ':"")+' class="'+v.join(" ")+'">'+b.html+"</li>",g.push(t),x.push(b.action)),k.push(b)}),g.length&&((t=document.createElement("div")).className=a,t.innerHTML='<ul class="'+(y?"has-checks":"")+'">'+g.join("")+"</ul>",g.forEach(function(e,n){p(t.children[0].children[n],"click",function(e){var t=x[n](l,e);!t&&e&&e.preventDefault()})}));return{element:t,items:k,open:u,hide:function(){t&&t.parentNode&&t.parentNode.removeChild(t),f=null}}}()).element,h(),t){if(t.style.visibility="hidden",(document.body||document).appendChild(t),e){var n=window.innerHeight+window.pageYOffset,i=window.innerWidth+window.pageXOffset;c(e)+t.offsetHeight>n?t.style.top=1*(n-t.offsetHeight-10)+"px":t.style.top=c(e)+"px",r(e)+t.offsetWidth>i?t.style.left=1*(i-t.offsetWidth-10)+"px":t.style.left=r(e)+"px",d&&e.target.classList.add(d),e.preventDefault(),e.stopPropagation()}else t.style.top=o.offsetTop+o.offsetHeight+"px",t.style.left=o.offsetLeft+o.offsetWidth+"px";t.style.visibility=""}return f=t,s}d=n.activeClass||!1,n.bindMenuOnClick&&p(o,"click",u),(n.bindMenuOnContextMenu===O||n.bindMenuOnContextMenu)&&p(o,"contextmenu",u),i.push({element:o,get:function(){return s},open:u,hide:function(){s&&s.hide()}})}}}typeof ko!=O+""&&e(ko),typeof module!=O+""&&module.exports&&typeof require!=O+""&&e(require("knockout"))}();